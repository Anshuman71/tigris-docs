# CRUD Operations

Tigris enables you to quickly add data and easily retrieve or edit that data
through simple and intuitive APIs.

The first step is to set up the collection object. All the CRUD operations
on the collection are performed through this collection object.

```go
users := tigris.GetCollection[User](db)
```

## Insert documents

Use the `Insert` API to insert one or more documents into the collection.
Since the `Id` field is marked as an autogenerated field we don't need to
specify a value for that field when inserting.

```go
_, err := users.Insert(ctx,
    &User{FirstName: "John", LastName: "McGrory", Balance: 6045.7},
    &User{FirstName: "Bunny", LastName: "Instone", Balance: 2948.87})
if err != nil {
    // handle error
}
```

The Insert API maintains uniqueness of the field marked as the primary key,
for example, the field `Id` in the example above. If a document with the
same primary key value already exists in the collection, the Insert fails.

## Upsert documents

Use the `InsertOrReplace` API to insert a new document or replace an existing
document with the same primary key value.

```go
_, err := users.InsertOrReplace(ctx,
    &User{Id: 1, FirstName: "Jania", LastName: "McGrory", Balance: 6045.7},
    &User{Id: 2, FirstName: "Bunny", LastName: "Instone", Balance: 2948.87})
if err != nil {
    // handle error
}
```

## Read documents

To read one or more documents, use the `Read` API. If filters are provided,
then documents matching the filtering condition are fetched.

```go
it, err := users.Read(ctx,
    filter.Or(
        filter.Eq("Id", 1),
        filter.Eq("Id", 2)
    ))
if err != nil {
    // handle error
}
defer it.Close()

var user User
for it.Next(&user) {
    fmt.Printf("%+v\n", user)
}

if it.Err() != nil {
    // handle error
}
```

### Read single document

To read a single document, use the `ReadOne` API.

```go
var user *User
user, err = users.ReadOne(ctx, filter.Eq("Id", 1)) // find user with Id 1
if err != nil {
    panic(err)
}
```

### Read all documents

Use the `ReadAll` API to read all the documents in the collection.

```go
it, err := users.ReadAll(ctx)
if err != nil {
    // handle error
}

defer it.Close()

var user User
for it.Next(&user) {
    fmt.Printf("%+v\n", user)
}

if it.Err() != nil {
    // handle error
}
```

## Search documents

To search for documents, use the `Search` API. Search consists of a query against text fields in a collection.

```go
request := search.NewRequestBuilder().WithQuery("Jania").Build()
it, err := users.Search(ctx, request)

if err != nil {
    // handle error
}

defer it.Close()

var result search.Result[User]
for it.Next(&result) {
    fmt.Printf("%+v\n", result)
}

if it.Err() != nil {
    // handle error
}
```

### Project search query against specific fields

By default, query is projected against all the text fields in collection. To project query against specific fields:

```go
request := search.NewRequestBuilder().
                WithQuery("Jania").
                WithSearchFields("FirstName", "LastName").
                Build()
```

### Refine the search results

[Filters](../overview/filter.md) can be applied to further refine the search results.

```go
request := search.NewRequestBuilder().
                WithQuery("Jania").
                WithSearchFields("FirstName", "LastName").
                WithFilter(filter.Eq("Balance", 2000))
                Build()
```

### Facet the search results

Optionally, facet query can be specified to retrieve aggregate count of values for one or more fields.

```go
request := search.NewRequestBuilder().
                WithQuery("Jania").
                WithSearchFields("FirstName").
                WithFilter(filter.Eq("Balance", 2000)).
                WithFacet(search.NewFacetQueryBuilder().
                    WithFields("LastName").
                    Build())
                Build()
```

## Update documents

The Update API is used to update existing documents that match the filters.
Fields that need to be updated are specified when calling the API.

In the following example, the field `Balance` is updated for documents which
match the filter `Id=1`.

```go
_, err := users.Update(ctx, filter.Eq("Id", "1"), fields.Set("Balance", 200))
if err != nil {
    // handle error
}
```

## Delete documents

Use the `Delete` API to delete documents that match the filters.

```go
_, err := users.Delete(ctx, filter.Eq("Id", "1"))
if err != nil {
    // handle error
}
```

### Delete all documents

In order to truncate the collection and delete all the documents in it, use
the `DeleteAll` API.

```go
_, err := users.DeleteAll(ctx)
if err != nil {
    // handle error
}
```
